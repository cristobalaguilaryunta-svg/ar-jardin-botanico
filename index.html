<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>AR Planta Individual</title>

  <!-- Motor 3D A-Frame -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>

  <!-- AR.js para WebAR sin apps -->
  <script src="https://cdn.jsdelivr.net/npm/ar.js@3.4.2/aframe/build/aframe-ar.js"></script>

  <!-- Datos de la planta -->
  <script src="data.js"></script>

  <style>
    #infoPanel {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.9);
      padding: 15px 20px;
      border-radius: 12px;
      max-width: 80%;
      text-align: center;
      font-family: sans-serif;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
  </style>
</head>

<body style="margin:0; overflow:hidden;">

  <!-- PANEL DE INFORMACIÓN HTML -->
  <div id="infoPanel"></div>

  <!-- ESCENA AR -->
  <a-scene embedded arjs>

  <!-- TEXTO FLOTANTE EN AR -->
    <a-entity id="textEntity"
              position="0 1 -2"
              text="value: Cargando...; color: #000; width: 2;">
    </a-entity>

    <!-- PANEL PNG FLOTANTE (imagen) -->
<a-plane id="panelImagen"
         src="url(imagenes/logotipo medio ambiente ayuntamiento.png)"
         position="1 1 -2"
         width="1.2"
         height="1.6"
         visible="false">
</a-plane>


    <!-- MODELOS 3D (se generan dinámicamente) -->
    <a-entity id="modelContainer"></a-entity>

    <!-- VIDEO FLOTANTE -->
    <a-video id="videoPlanta" visible="false"
             width="1.5" height="0.9"
             position="0 0.5 -2">
    </a-video>

    <video id="videoSrc" style="display:none" autoplay loop muted></video>

    <!-- AUDIO AMBIENTE -->
    <a-entity id="audioAmbiente"></a-entity>

    <!-- AUDIO EXPLICATIVO -->
    <a-entity id="audioExplicativo"></a-entity>

  </a-scene>

  <script>
    // ============================================================
    // 1. Cargar la planta desde ?planta=ENCINA
    // ============================================================
    const params = new URLSearchParams(window.location.search);
    const plantaID = params.get("planta");
    const planta = PLANT_DATA[plantaID];

    if (!planta) {
      document.getElementById("infoPanel").innerHTML = "Planta no encontrada";
      throw new Error("Planta no encontrada");
    }

    // ============================================================
    // 2. Panel HTML con texto y PDFs
    // ============================================================
    let pdfLinks = "";
    if (planta.pdf) {
      pdfLinks = planta.pdf.map(p => `<a href="${p}" target="_blank">Abrir PDF</a><br>`).join("");
    }

    document.getElementById("infoPanel").innerHTML = `
      <h2>${planta.nombre}</h2>
      <p>${planta.descripcion}</p>
      ${pdfLinks}
    `;

    // ============================================================
    // 3. Texto flotante en AR
    // ============================================================
    document.getElementById("textEntity").setAttribute("text", {
      value: planta.nombre,
      color: "#000",
      width: 2
    });

    // ============================================================
    // 4. Modelos 3D (varios)
    // ============================================================
    const modelContainer = document.getElementById("modelContainer");
    modelContainer.innerHTML = ""; // limpiar

    if (planta.modelos3d) {
      planta.modelos3d.forEach((modelo, i) => {
        const y = i * 0.7; // apilar modelos verticalmente
        const entity = document.createElement("a-entity");
        entity.setAttribute("gltf-model", `url(${modelo})`);
        entity.setAttribute("position", `0 ${y} -2`);
        entity.setAttribute("scale", "0.5 0.5 0.5");
        modelContainer.appendChild(entity);
      });
    }

    // ============================================================
    // 5. Video flotante
    // ============================================================
    if (planta.video) {
      const videoSrc = document.getElementById("videoSrc");
      const video = document.getElementById("videoPlanta");

      videoSrc.src = planta.video;
      video.setAttribute("src", "#videoSrc");
      video.setAttribute("visible", true);
    }

    // ============================================================
    // 6. Audio ambiente en loop
    // ============================================================
    if (planta.audioAmbiente) {
      document.getElementById("audioAmbiente")
        .setAttribute("sound", `src: url(${planta.audioAmbiente}); autoplay: true; loop: true;`);
    }

    // ============================================================
    // 7. Audio explicativo
    // ============================================================
    if (planta.audioExplicativo) {
      document.getElementById("audioExplicativo")
        .setAttribute("sound", `src: url(${planta.audioExplicativo}); autoplay: true;`);
    }

  </script>

</body>
</html>
